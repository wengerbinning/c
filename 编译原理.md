# C编译原理

[//]: # (__author__ = "Clark Aaron")

C语言源码需要经过预处理器、编译器、汇编器、链接器四个过程后才能生成可执行程序。

## 预处理器

预处理器是为了处理预处理命令的的程序。


### 宏定义

* #define
* 用作 常数及简单的计算 对其中变量只做替换，不做计算
* 可带参数实现函数功能
* #undef 取消已定义的宏定义 --- 将宏定义限制在一个代码块内

### 条件编译

* ifdef - endif

  ```C
  #ifdef <标识符>
  <程序段>;
  #endif  
  ```

* ifdef - else - endif 条件编译

  ```C
  #ifdef <标识符>
  <程序段1>;
  #else
  <程序段2>;
  #endif        //如果标识符已被 #define 命令定义过则对程序段 1 进行编译;否则对程序段 2 进行编译。
  ```

* ifndef - else - endif 条件编译

  ```C
  #ifndef <标识符>
  <程序段1>;
  #else
  <程序段2>;
  #endif        //如果标识符未被#define 命令定义过则对程 序段 1 进行编译,否则对程序段 2 进行编译。这与第一种形式的功能正好相反。
  ```

* if - else - endif 条件编译

  ```C
  #if <常量表达式>
  <程序段1>;
  #else
  <程序段2>;
  #endif      //常量表达式的值为真(非 0),则对程序段 1 进行编译,否则对程序段 2 进行编译。
  ```

### 编译停止

> 强制停止编译:

  ```C
  #error <message>    //强制停止编译并输出信息;
  ```

> 修改特殊变量的值: 主要用于调试与特殊应用

  ```C
  #line <行号值> <当前编译文件名>   //修改 __LINE__ 与 __FILE__ 值 (__LINE__ 与　__FILE＿　是预编译程序中预定义的标识符)
  ```

* 文件包含
  
  * #include <fileName>

### 编译参数

* 编译指示指令

  * #pragram: 设定编译器的状态,指示编译器完成一些特定的动作

    | 参数     | 说明 |
    | :------- | ---- |
    | message  |      |
    | code_seg |      |
    | once     |      |
    | hdrstop  |      |
    | resource |      |
    | warning  |      |
    | comment  |      |

* 预定义的宏名:
  * \_LINE\_	行号
  * \_FILE\_     名称
  * \_DATA\_    日期
  * \_TIME\_     时间
  * \_STDC\_    是否执行ANSI C标准

## 编译器

编译器是将预处理之后的源码编译成汇编程序。生成的汇编文件一般以`*.s`结尾。

* 生成汇编文件：

  ```shell
  gcc -0g -S <file.c>
  ```

## 汇编器

汇编器是将汇编源码转化为目标源码的程序。生成的目标文件以`*.o`结尾。

```shell
gcc -0g -c <file.c>
```


## 反汇编器

反汇编器是根据目标文件生成汇编文件的程序。

```shell
objdump -d <file.o>
```


## 链接器

链接器是为函数调用找到匹配函数的执行代码的位置。